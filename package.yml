name       : modelio
version    : 4.0.1
release    : 5
source     :
    - https://forge.modelio.org/attachments/download/23699/modelio_sources_4.0.1.zip : 809741f8d2351ec450177b6b74a82f2f11c23071117656b139d7b43e4b342739
license    : GPL-3-or-later
component  : programming.tools
summary    : UML modeling tool
description: |
    Modelio is an open source UML modeling tool.
networking : yes
builddeps  :
    - apache-maven
rundeps    :
    - libwebkit-gtk
    - openjdk-11
setup      : |
    # modelio uses a lot of fragile undefined maven behavior. this patch combats this. ask @serebit for help if this doesn't work 
    cp dev-platform/compilation-env/javadesigner.jar modelio/app/editors.richnote.libreoffice/lib/
    mkdir modelio/app/editors.richnote.microsoft/lib
    cp dev-platform/compilation-env/javadesigner.jar modelio/app/editors.richnote.microsoft/lib/
    cp dev-platform/rcp-target/rcp-eclipse/eclipse/plugins/org.eclipse.swt.win32.win32.x86_3*.jar modelio/app/editors.richnote.microsoft/lib/eclipse.jar
    %patch -p1 < $pkgfiles/0001-Fix-building-with-maven-and-java-11.patch
build      : |
    cd AGGREGATOR
    mvn -Dmaven.repo.local=$workdir/.m2 package
install    : |
    install -dm00755 $installdir/usr/share/modelio
    cp -a products/target/products/org.modelio.product/linux/gtk/x86_64/Modelio*/* $installdir/usr/share/modelio
    install -d $installdir/usr/bin
    ln -s /usr/share/modelio/modelio $installdir/usr/bin/modelio
    install -d $installdir/usr/share/pixmaps
    cp -a $installdir/usr/share/modelio/icon.xpm $installdir/usr/share/pixmaps/modelio.xpm
    install -dm00755 $installdir/usr/share/mime/packages
    cp $pkgfiles/modelio.xml $installdir/usr/share/mime/packages
    install -Dm00644 $pkgfiles/modelio.desktop -t $installdir/usr/share/applications

    # Set the correct OpenJDK
    sed -i '/-vmargs/i -vm\n/usr/lib64/openjdk-8/bin/java' $installdir/usr/share/modelio/modelio.ini
